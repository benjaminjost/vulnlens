"use client"

import { CVERecord } from "@/models/CVERecord"
import { ColumnDef } from "@tanstack/react-table"

export const columns: ColumnDef<CVERecord>[] = [
  {
    accessorKey: "cveId",
    header: "CVE ID",
    enableSorting: true,
    cell: ({ row }) => (
      <div className="flex items-center gap-2">
        <span className="cve-id font-mono text-sm font-semibold text-blue-600 dark:text-blue-400">
          {row.getValue("cveId")}
        </span>
      </div>
    ),
  },
  {
    accessorKey: "name",
    header: "Vulnerability",
    enableSorting: true,
    cell: ({ row }) => {
      const name = row.original.name || row.original.product || "N/A"
      return (
        <div className="flex flex-col gap-1">
          <div className="font-medium text-slate-900 dark:text-slate-100 max-w-md">
            {name}
          </div>
          {row.original.vendor && (
            <div className="text-xs text-slate-500 dark:text-slate-400">
              {row.original.vendor}
            </div>
          )}
        </div>
      )
    },
  },
  {
    accessorKey: "score",
    header: "CVSS Score",
    enableSorting: true,
    sortingFn: (rowA, rowB) => {
      const scoreA = parseFloat(rowA.getValue("score"))
      const scoreB = parseFloat(rowB.getValue("score"))
      return scoreA - scoreB
    },
    cell: ({ row }) => {
      const score = parseFloat(row.getValue("score"))
      
      return (
        <div className="text-sm text-slate-900 dark:text-slate-100">
          <span className="font-semibold">{score.toFixed(1)}</span>
        </div>
      )
    },
  },
  {
    accessorKey: "severity",
    header: "Severity",
    enableSorting: true,
    sortingFn: (rowA, rowB) => {
      const severityOrder: Record<string, number> = {
        critical: 4,
        high: 3,
        medium: 2,
        low: 1,
        unknown: 0,
      }
      const severityA = (rowA.getValue("severity") as string).toLowerCase()
      const severityB = (rowB.getValue("severity") as string).toLowerCase()
      return (severityOrder[severityA] || 0) - (severityOrder[severityB] || 0)
    },
    cell: ({ row }) => {
      const severity = row.getValue("severity") as string
      const severityLower = severity.toLowerCase()
      
      let badgeColor = "bg-slate-100 text-slate-700"
      
      if (severityLower === "critical") {
        badgeColor = "bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"
      } else if (severityLower === "high") {
        badgeColor = "bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"
      } else if (severityLower === "medium") {
        badgeColor = "bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"
      } else if (severityLower === "low") {
        badgeColor = "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"
      }
      
      return (
        <span className={`inline-flex items-center px-3 py-1 rounded-md text-xs font-medium ${badgeColor}`}>
          {severity}
        </span>
      )
    },
  },
  {
    accessorKey: "ageInDays",
    header: "Age",
    enableSorting: true,
    sortingFn: (rowA, rowB) => {
      const ageA = rowA.getValue("ageInDays") as number
      const ageB = rowB.getValue("ageInDays") as number
      return ageA - ageB
    },
    cell: ({ row }) => {
      const age = row.getValue("ageInDays") as number
      return (
        <div className="text-sm text-slate-600 dark:text-slate-300">
          <span className="font-medium">{age}</span> {age === 1 ? 'day' : 'days'}
        </div>
      )
    },
  },
  {
    accessorKey: "hasPoC",
    header: "PoC",
    enableSorting: true,
    sortingFn: (rowA, rowB) => {
      const pocA = rowA.getValue("hasPoC") as boolean
      const pocB = rowB.getValue("hasPoC") as boolean
      return (pocA ? 1 : 0) - (pocB ? 1 : 0)
    },
    cell: ({ row }) => {
      const hasPoC = row.getValue("hasPoC") as boolean
      return (
        <div className="flex items-center">
          {hasPoC ? (
            <span className="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400">
              Yes
            </span>
          ) : (
            <span className="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400">
              No
            </span>
          )}
        </div>
      )
    },
  },
]
